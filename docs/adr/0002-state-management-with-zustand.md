# ADR-0002: 状態管理にZustandを採用

## ステータス
廃止

## コンテキスト
本プロジェクトは ADR-0001 にて「Hono + React による SSR」を前提とし、初期表示データはサーバーで統合・整形して HTML に埋め込み、必要最小限のハイドレーションで表示する方針とした。現時点では、クライアント横断で共有すべきグローバル状態は想定しておらず、各 UI はサーバーから受け取った props とコンポーネント内の局所状態（`useState` 等）で完結可能である。

## 検討した選択肢

### 選択肢1: Redux Toolkit
- **メリット**
  - 成熟したエコシステム
  - DevToolsが充実
  - タイムトラベルデバッギング
  - 予測可能な状態更新
- **デメリット**
  - ボイラープレートが多い
  - 学習曲線が急
  - バンドルサイズが大きい（〜12KB）

### 選択肢2: Zustand
- **メリット**
  - 極小バンドルサイズ（〜2.6KB）
  - シンプルなAPI
  - TypeScriptサポートが優秀
  - ボイラープレートが少ない
  - React外でも使用可能
- **デメリット**
  - DevToolsが限定的
  - コミュニティが比較的小さい

### 選択肢3: Jotai
- **メリット**
  - React Suspenseとの統合
  - アトミックな状態管理
  - 派生状態の扱いが優秀
- **デメリット**
  - コンセプトの理解が難しい
  - SSRとの相性に課題

### 選択肢4: Context API + useReducer
- **メリット**
  - 追加依存なし
  - Reactネイティブ
- **デメリット**
  - パフォーマンス最適化が困難
  - 大規模アプリには不向き
  - 再レンダリング制御が難しい

### 選択肢5: Valtio
- **メリット**
  - プロキシベースで直感的
  - ミュータブルな更新
- **デメリット**
  - プロキシのブラウザ互換性
  - デバッグが困難

## 決定
本ADRの提案は廃止し、現状は「グローバルなクライアント状態管理ライブラリを採用しない」。

## 理由
1. **SSR前提で十分**: 初期データはサーバーで統合し、画面遷移や再計算もサーバーラウンドトリップで成立する。
2. **複雑性の削減**: グローバルストアを導入せず、コンポーネントローカルな状態で十分に表現できる。
3. **バンドル最小化**: クライアント依存を増やさず、必要最小限のハイドレーションに留める。
4. **データの単一源泉**: 真のソースはサーバー側（GitHub API + CSVの統合結果）に置き、クライアントは表示責務に集中。

## 影響

### ポジティブ
- グローバル状態層がなくなり実装が単純化。
- クライアントバンドルと依存関係が最小化。
- サーバー中心の一貫したデータモデルを維持。

### ネガティブ / トレードオフ
- クライアントのみでの複雑な双方向インタラクションは設計上抑制。
- 完全リアルタイム同期が必要になった場合は別途検討（SSE/WebSocket など）。

## 実装メモ（現方針）

```typescript
// SSRで整形したデータを埋め込み、コンポーネントは props で受け取る
type DashboardProps = {
  users: User[];
  usage: UsageData[];
  billing: BillingData[];
};

export function Dashboard({ users, usage, billing }: DashboardProps) {
  // UI上の一時的な状態はローカルに保持
  const [filter, setFilter] = useState<string>("");
  const filtered = useMemo(
    () => users.filter(u => u.name.includes(filter)),
    [users, filter]
  );
  return (
    <>
      <input value={filter} onChange={e => setFilter(e.target.value)} />
      <UserList users={filtered} />
    </>
  );
}

// 追加のデータ取得や変更は、フォーム送信やリンク遷移でサーバーへ委譲
```

## 将来の見直し条件

以下の条件が満たされた場合、クライアント状態管理の導入を再検討する：
- グラフ・テーブル間での複雑な双方向連携が必要になった。
- ページ横断で共有すべきユーザー操作状態が増えた。
- オフラインやローカル永続化要件が明確になった。
- リアルタイム更新（SSE/WebSocket）が普及し、クライアント側で集約が必要。

## 参考資料
- [SSRのベストプラクティス（React）](https://react.dev/reference/react-dom/server)
